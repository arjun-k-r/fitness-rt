<ion-header>
  <ion-navbar>
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>Profile</ion-title>
    <ion-buttons end>
      <button clear (click)="save()" [disabled]="profileForm.invalid" ion-button>
        Save
      </button>
      <button icon ion-button (click)="viewPageInfo()">
        <ion-icon name="information-circle"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
  <ion-toolbar>
    <ion-segment [(ngModel)]="profilePageSegment">
      <ion-segment-button value="userInfo">
        Info
      </ion-segment-button>
      <ion-segment-button value="trends">
        Trends
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div [ngSwitch]="profilePageSegment">
    <div *ngSwitchCase="'userInfo'">
      <ion-grid>
        <ion-row align-items-center justify-content-center>
          <ion-col class="avatar">
            <div class="avatar__icon" *ngIf="!userInfo?.photoURL" text-center>
              <ion-icon name="person"></ion-icon>
            </div>
            <div class="avatar__image" [style.backgroundImage]="'url(' + userInfo?.photoURL + ')'" *ngIf="userInfo?.photoURL"></div>
            <button block (click)="changeImage()" ion-button>Change avatar</button>
          </ion-col>
          <ion-col>
            <h1>{{ userInfo?.displayName }}</h1>
            <p>{{ userInfo?.email }}</p>
          </ion-col>
        </ion-row>
      </ion-grid>
      <input type="file" #fileInput style="visibility: hidden; height: 0px" (change)="processWebImage($event)" />
      <ion-list no-lines>
        <ion-list-header>Bio</ion-list-header>
        <form [formGroup]="profileForm" novalidate>
          <ion-item>
            <ion-label fixed>Age</ion-label>
            <ion-input formControlName="age"></ion-input>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.age.touched && profileForm.controls.age.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please enter your age.
          </div>
          <ion-item>
            <ion-label>Gender</ion-label>
            <ion-select formControlName="gender">
              <ion-option value="female">Female</ion-option>
              <ion-option value="male">Male</ion-option>
            </ion-select>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.gender.touched && profileForm.controls.gender.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please select your gender.
          </div>
          <!--
          <ion-item>
            <ion-label>Constitution</ion-label>
            <ion-select formControlName="constitution">
              <ion-option value="v">Vata</ion-option>
              <ion-option value="vp">Vata-Pitta</ion-option>
              <ion-option value="p">Pitta</ion-option>
              <ion-option value="pk">Pitta-Kapha</ion-option>
              <ion-option value="k">Kapha</ion-option>
              <ion-option value="kv">Kapha-Vata</ion-option>
              <ion-option value="vkp">Vata-Pitta-Kapha</ion-option>
            </ion-select>
          </ion-item>
          <button (click)="takeConstitutionTest()" ion-item>
            <h2 color="primary" ion-text>Take self-test</h2>
            <ion-note item-right>
              <ion-icon name="arrow-forward"></ion-icon>
            </ion-note>
          </button>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.constitution.touched && profileForm.controls.constitution.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please select your constitution.
          </div>
          -->
          <ion-item>
            <ion-label>Metabolic type</ion-label>
            <ion-select formControlName="metabolicType">
              <ion-option value="protein">Protein</ion-option>
              <ion-option value="mixed">Mixed</ion-option>
              <ion-option value="carbo">Carbo</ion-option>
            </ion-select>
          </ion-item>
          <button (click)="takeMetabolicTypeTest()" ion-item>
            <h2 color="primary" ion-text>Take self-test</h2>
            <ion-note item-right>
              <ion-icon name="arrow-forward"></ion-icon>
            </ion-note>
          </button>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.metabolicType.touched && profileForm.controls.metabolicType.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please select your metabolic type.
          </div>
          <div *ngIf="userProfile.gender === 'female'">
            <ion-item>
              <ion-label>Pregnant</ion-label>
              <ion-toggle formControlName="isPregnant"></ion-toggle>
            </ion-item>
            <ion-item>
              <ion-label>Lactating</ion-label>
              <ion-toggle formControlName="isLactating"></ion-toggle>
            </ion-item>
          </div>
          <ion-list-header>Measurements</ion-list-header>
          <ion-item>
            <ion-label fixed>Chest (cm)</ion-label>
            <ion-input formControlName="chestMeasurement"></ion-input>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.chestMeasurement.touched && profileForm.controls.chestMeasurement.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please enter your chest measurement.
          </div>
          <ion-item>
            <ion-label fixed>Height (cm)</ion-label>
            <ion-input formControlName="heightMeasurement"></ion-input>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.heightMeasurement.touched && profileForm.controls.heightMeasurement.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please enter your height.
          </div>
          <ion-item>
            <ion-label fixed>Hips (cm)</ion-label>
            <ion-input formControlName="hipsMeasurement"></ion-input>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.hipsMeasurement.touched && profileForm.controls.hipsMeasurement.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please enter your hips measurement.
          </div>
          <ion-item>
            <ion-label fixed>Neck (cm)</ion-label>
            <ion-input formControlName="neckMeasurement"></ion-input>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.neckMeasurement.touched && profileForm.controls.neckMeasurement.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please enter your neck measurement.
          </div>
          <ion-item>
            <ion-label fixed>Waist (cm)</ion-label>
            <ion-input formControlName="waistMeasurement"></ion-input>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.waistMeasurement.touched && profileForm.controls.waistMeasurement.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please enter your waist measurement.
          </div>
          <ion-item>
            <ion-label fixed>Weight (kg)</ion-label>
            <ion-input formControlName="weightMeasurement"></ion-input>
          </ion-item>
          <div class="form__message--dark" *ngIf="profileForm.invalid && profileForm.controls.weightMeasurement.touched && profileForm.controls.weightMeasurement.errors?.required">
            <ion-icon name="warning"></ion-icon>
            Please enter your weight.
          </div>
        </form>
        <ion-list-header>Fitness</ion-list-header>
        <ion-item>
          <h2>Basal metabolic rate</h2>
          <p item-content>{{ userProfile.fitness.bmr }} kcal/day</p>
        </ion-item>
        <ion-item>
          <h2>Body shape</h2>
          <p item-content>{{ userProfile.fitness.bodyShape }}</p>
        </ion-item>
        <ion-item>
          <h2>Ideal waist</h2>
          <p item-content>{{ userProfile.fitness.idealWaist }}</p>
        </ion-item>
        <ion-item>
          <h2>Ideal weight</h2>
          <p item-content>{{ userProfile.fitness.idealWeight }}</p>
        </ion-item>
        <ion-list-header>Body fat</ion-list-header>
        <ion-item>
          <h2>Fat category</h2>
          <p item-content>{{ userProfile.fitness.bodyFatPercentage.category }}</p>
        </ion-item>
        <ion-item>
          <h2>Fat mass</h2>
          <p item-content>{{ userProfile.fitness.bodyFatPercentage.fatMass }} kg</p>
        </ion-item>
        <ion-item>
          <h2>Lean muscle mass</h2>
          <p item-content>{{ userProfile.fitness.bodyFatPercentage.muscleMass }} kg</p>
        </ion-item>
        <ion-item>
          <h2>Body fat percentage</h2>
          <p item-content>{{ userProfile.fitness.bodyFatPercentage.fatPercentage }}%</p>
        </ion-item>
        <ion-item>
          <h2>Ideal body fat percentage</h2>
          <p item-content>{{ userProfile.fitness.bodyFatPercentage.ideal }}%</p>
        </ion-item>
      </ion-list>
    </div>
    <div *ngSwitchCase="'trends'">
      <ion-list no-lines>
        <ion-list-header>Chart settings</ion-list-header>
        <ion-item>
          <ion-label fixed>Trend days</ion-label>
          <ion-input (ionChange)="getTrends()" [(ngModel)]="trendDays" type="number"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>Fitness data</ion-label>
          <ion-select [(ngModel)]="chartDataSelection" (ionChange)="changeChartData()">
            <ion-option role="option" value="bodyFat">Body fat percentage</ion-option>
            <ion-option role="option" value="chestMeasurement">Chest</ion-option>
            <ion-option role="option" value="heightMeasurement">Height</ion-option>
            <ion-option role="option" value="hipsMeasurement">Hips</ion-option>
            <ion-option role="option" value="neckMeasurement">Neck</ion-option>
            <ion-option role="option" value="waistMeasurement">Waist</ion-option>
            <ion-option role="option" value="weightMeasurement">Weight</ion-option>
          </ion-select>
        </ion-item>
        <ion-list-header>Chart</ion-list-header>
      </ion-list>
      <canvas baseChart class="chart" [chartType]="'line'" [colors]="chartColors" [datasets]="chartData" [labels]="chartLabels"
        [legend]="true" [options]="chartOpts">
      </canvas>
    </div>
  </div>
</ion-content>